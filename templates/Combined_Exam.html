<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCAS Prep - Mock Exam</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="../assets/css/result_page.css">
    <link rel="stylesheet" href="../assets/css/styles.min.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link rel="stylesheet" href="../assets/css/combined_exam.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="../assets/images/favicon.png">
    
</head>
<body class="combined-exam-page">
    <!-- Menu overlay for mobile -->
    <div class="menu-overlay"></div>
    
    <!-- Header will be included here -->
    <div id="header-placeholder"></div>
    
<!-- Left Ad Banner Container -->
<div class="ad-container left">
    <div class="ad-banner">
        <img src="../assets/images/grammar_exercise.jpg" alt="English Tutors">
        <div class="ad-content">
            <h4>Expert English Tutors</h4>
            <p>One-on-one sessions with TCAS exam specialists</p>
            <a href="../templates/tutors.html" class="ad-action">Find a Tutor</a>
        </div>
        <button class="ad-close"><i class="fas fa-times"></i></button>
    </div>
    <div class="ad-banner">
        <img src="../assets/images/grammar_exercise.jpg" alt="Study Materials">
        <div class="ad-content">
            <h4>Premium Study Materials</h4>
            <p>Access exclusive TCAS English practice resources</p>
            <a href="materials.html" class="ad-action">Browse Now</a>
        </div>
        <button class="ad-close"><i class="fas fa-times"></i></button>
    </div>
</div>

    
<!-- Right Ad Banner Container -->
<div class="ad-container right">
    <div class="ad-banner">
        <img src="../assets/images/grammar_exercise.jpg" alt="Online Workshops">
        <div class="ad-content">
            <h4>TCAS English Workshops</h4>
            <p>Join our weekly online preparation classes</p>
            <a href="workshops.html" class="ad-action">Register</a>
        </div>
        <button class="ad-close"><i class="fas fa-times"></i></button>
    </div>
    <div class="ad-banner">
        <img src="../assets/images/grammar_exercise.jpg" alt="Premium Subscription">
        <div class="ad-content">
            <h4>Go Premium</h4>
            <p>Unlock all practice exams and performance analytics</p>
            <a href="premium.html" class="ad-action">Upgrade</a>
        </div>
        <button class="ad-close"><i class="fas fa-times"></i></button>
    </div>
</div>

    
    <main>
        <div id="exam-info">
            <div class="exam-info-container">
                <div class="exam-info-header">
                    <h1>ข้อสอบจำลอง A-Level ภาษาอังกฤษ</h1>
                    <p class="header-description">เลือกข้อสอบที่ต้องการทำ</p>
                </div>
                
                <!-- Exam Selection Section -->
                <div class="exam-selection">
                    <div class="exam-options" id="exam-options-container">
                        <!-- Exam options will be dynamically loaded from exam_metadata.json -->
                    </div>
                </div>
                
                <!-- Exam Details Section (will be dynamically updated based on selection) -->
                <div class="exam-info-content">
                    <!-- Left column: Exam details -->
                    <div class="exam-details-column">
                        <div class="exam-card">
                            <div class="exam-card-header">
                                <i class="fas fa-info-circle"></i>
                                <h3>รายละเอียดการทดสอบ</h3>
                            </div>
                            <div class="exam-metadata-grid">
                                <div class="metadata-item">
                                    <i class="fas fa-list-ol"></i>
                                    <div class="metadata-content">
                                        <span class="metadata-label">จำนวนข้อสอบ:</span>
                                        <span id="total-questions-count" class="metadata-value">80</span>
                                    </div>
                                </div>
                                <div class="metadata-item">
                                    <i class="fas fa-clock"></i>
                                    <div class="metadata-content">
                                        <span class="metadata-label">เวลา:</span>
                                        <span id="exam-time" class="metadata-value">90 นาที</span>
                                    </div>
                                </div>
                                <div class="metadata-item">
                                    <i class="fas fa-tasks"></i>
                                    <div class="metadata-content">
                                        <span class="metadata-label">ประเภทข้อสอบ:</span>
                                        <span class="metadata-value">Multiple Categories</span>
                                    </div>
                                </div>
                                <div class="metadata-item">
                                    <i class="fas fa-chart-line"></i>
                                    <div class="metadata-content">
                                        <span class="metadata-label">ระดับความยาก:</span>
                                        <span id="exam-difficulty" class="metadata-value">ปานกลาง-ยาก</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="exam-description">
                                <p id="exam-description-th">แบบทดสอบรวมทักษะที่หลากหลาย ประกอบด้วยโจทย์บทสนทนาสั้น (3) บทสนทนายาว (1) โฆษณา (2) สินค้า (2) ข่าว (2) บทความ (2) แบบเติมคำ (3) และการจัดย่อหน้า (5)</p>
                                <p id="exam-description-en">This comprehensive exam combines all question types to simulate the full TCAS English testing experience. Each question will be labeled with its category to help you track your performance across different skills.</p>
                            </div>
                            
                            <div class="exam-benefits">
                                <div class="benefit-item">
                                    <i class="fas fa-chart-pie"></i>
                                    <span>วิเคราะห์ความสามารถของคุณแยกตามทักษะ</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-bullseye"></i>
                                    <span>ค้นพบจุดแข็งและจุดที่ต้องปรับปรุง</span>
                                </div>
                                <div class="benefit-item">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span>ประเมินความพร้อมก่อนสอบจริง</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="start-exam-card">
                            <button id="start-combined-exam" class="btn-start-exam" data-current-exam="exam1">
                                <i class="fas fa-play-circle"></i>
                                <span>เริ่มทำข้อสอบ</span>
                            </button>
                            <p class="start-note">เมื่อเริ่มทำข้อสอบ นาฬิกาจะเริ่มนับเวลาทันที</p>
                        </div>
                    </div>
                    
                    <!-- Right column: Question distribution -->
                    <div class="question-distribution-column">
                        <div class="distribution-card">
                            <div class="distribution-card-header">
                                <i class="fas fa-chart-bar"></i>
                                <h3>Question Distribution</h3>
                            </div>
                            
                            <div class="distribution-skills">
                                <!-- Speaking Section -->
                                <div class="skill-section speaking">
                                    <div class="skill-header">
                                        <h4><i class="fas fa-comment"></i> Speaking</h4>
                                        <span class="skill-count">20 ข้อ</span>
                                    </div>
                                    <div class="question-types">
                                        <div class="question-type-item">
                                            <span class="question-type-indicator short-conversation">Short Conversation</span>
                                            <span class="type-count">12 ข้อ</span>
                                        </div>
                                        <div class="question-type-item">
                                            <span class="question-type-indicator long-conversation">Long Conversation</span>
                                            <span class="type-count">8 ข้อ</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Reading Section -->
                                <div class="skill-section reading">
                                    <div class="skill-header">
                                        <h4><i class="fas fa-book"></i> Reading</h4>
                                        <span class="skill-count">40 ข้อ</span>
                                    </div>
                                    <div class="question-types">
                                        <div class="question-type-item">
                                            <span class="question-type-indicator advertisement">Advertisement</span>
                                            <span class="type-count">6 ข้อ</span>
                                        </div>
                                        <div class="question-type-item">
                                            <span class="question-type-indicator product">Product</span>
                                            <span class="type-count">12 ข้อ</span>
                                        </div>
                                        <div class="question-type-item">
                                            <span class="question-type-indicator news-report">News Report</span>
                                            <span class="type-count">6 ข้อ</span>
                                        </div>
                                        <div class="question-type-item">
                                            <span class="question-type-indicator article">Article</span>
                                            <span class="type-count">16 ข้อ</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Writing Section -->
                                <div class="skill-section writing">
                                    <div class="skill-header">
                                        <h4><i class="fas fa-pen"></i> Writing</h4>
                                        <span class="skill-count">20 ข้อ</span>
                                    </div>
                                    <div class="question-types">
                                        <div class="question-type-item">
                                            <span class="question-type-indicator text-completion">Text Completion</span>
                                            <span class="type-count">15 ข้อ</span>
                                        </div>
                                        <div class="question-type-item">
                                            <span class="question-type-indicator paragraph">Paragraph</span>
                                            <span class="type-count">5 ข้อ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="total-distribution">
                                <div class="total-item">
                                    <div class="total-label">Total Questions:</div>
                                    <div class="total-value">80</div>
                                </div>
                                <div class="distribution-bar">
                                    <div class="bar-segment speaking-segment" style="width: 25%;" title="Speaking: 4 questions (20%)"></div>
                                    <div class="bar-segment reading-segment" style="width: 50%;" title="Reading: 8 questions (40%)"></div>
                                    <div class="bar-segment writing-segment" style="width: 25%;" title="Writing: 8 questions (40%)"></div>
                                </div>
                                <div class="distribution-legend">
                                    <div class="legend-item">
                                        <span class="legend-color speaking-color"></span>
                                        <span>Speaking</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color reading-color"></span>
                                        <span>Reading</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color writing-color"></span>
                                        <span>Writing</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <section id="exam-content" class="hidden">
            <!-- Back button repositioned outside the header -->
                <button id="back-button" class="btn-icon" aria-label="Back to exam info">
                    <i class="icon-back"></i>
                </button>
            
            <div class="exam-header">
                <div class="exam-title-container">
                    <!-- Subtitle will be inserted here by JavaScript -->
                </div>
            </div>
            
            <div class="exam-questions-container">
                <div class="exam-timer">
                    <i class="icon-timer"></i>
                    <span id="timer-display"> 00:00</span>
                </div>
                
                <div class="progress-container">    
                    <div class="hidden">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" style="display: none;">
                        Question <span id="current-question">0</span>
                    </div>
                </div>
            
                <div id="exam-questions">
                    <!-- Questions will be loaded here -->
                </div>
                
                <div class="exam-navigation">
                    <button id="prev-question" class="btn secondary">ข้อก่อนหน้า</button>
                    <button id="next-question" class="btn">ข้อต่อไป</button>
                    <button id="submit-exam" class="btn accent">ส่งคำตอบ</button>
                </div>
                
                <!-- New Question Progress and Navigator -->
                <div class="question-progress-wrapper">
                    <h3>Your Progress</h3>
                    
                    <!-- Visual progress indicator -->
                    <div class="visual-progress">
                        <div class="progress-indicator">
                            <div class="progress-indicator-fill" id="visual-progress-fill"></div>
                        </div>
                        <div class="progress-stats">
                            <span id="answered-count">0</span>
                            <span id="total-question-count">0</span>
                        </div>
                    </div>
                    
                    <!-- Question navigator -->
                    <h3>Question Navigator</h3>
                    <div class="question-navigator" id="question-navigator">
                        <!-- Question buttons will be inserted here by JavaScript -->
                    </div>
                    
                    <!-- Legend -->
                    <div class="question-legend">
                        <div class="legend-item">
                            <div class="legend-color legend-current"></div>
                            <span>ขณะนี้</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-answered"></div>
                            <span>เลือกคำตอบแล้ว</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-unanswered"></div>
                            <span>ยังไม่เลือกคำตอบ</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <div id="results" class="hidden">
            <div class="results-container">
                <div class="results-header">
                    <h2>ผลการทดสอบ</h2>
                    <div class="results-actions">
                        <button id="back-to-home" class="btn accent">กลับหน้าหลัก</button>
                        <button id="view-progress" class="btn secondary">ดูพัฒนาการ</button>
                        <button id="view-feedback" class="btn secondary">แสดงรายละเอียด</button>
                    </div>
                </div>
                
                <div class="results-details-section">
                <div class="results-overview">
                    <h3>ผลการทดสอบของคุณ</h3>
                    <div class="score-overview">
                        <div class="score-circle-container">
                            <svg viewBox="0 0 36 36" class="overall-score-chart">
                                <path class="score-circle-bg"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="score-circle-fill"
                                    d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831"
                                    id="score-path"/>
                                <text x="18" y="18" class="score-text" id="score">0</text>
                                <text x="18" y="24" class="score-label-text">Score</text>
                            </svg>
                            <div class="score-label">ประสิทธิภาพรวม</div>
                        </div>
                        
                        <div class="result-stats">
                            <div class="stat-group">
                                <div class="stat-item">
                                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                                    <div class="stat-content">
                                        <div class="stat-label">ข้อทึ่ถูก</div>
                                        <div class="stat-value"><span id="correct-count">0</span> / <span id="total-questions">0</span></div>
                                    </div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                    <div class="stat-content">
                                        <div class="stat-label">เวลา</div>
                                        <div class="stat-value" id="time-taken">00:00</div>
                                    </div>
                                </div>
                            </div>
                            <div class="performance-comment">
                                <div class="comment-icon"><i class="fas fa-comment-alt"></i></div>
                                <div class="comment-text" id="performance-text">ควรปรับปรุงอย่างเร่งด่วน</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Percentile Rank Visualization -->

                </div>
                <div class="percentile-section">
                    <h3>เปรียบเทียบกับผู้เข้าสอบอื่น</h3>
                    <div class="percentile-container">
                        <div class="percentile-rank-info">
                            <div class="percentile-number">≈<span id="percentile-value">0</span></div>
                            <div class="percentile-label">เปอร์เซ็นต์ไทล์</div>
                            <div class="percentile-description">
                                คุณได้ลำดับที่ ≈<span id="percentile-text">0%</span> ของผู้เข้าสอบทั้งหมด
                            </div>
                        </div>
                        <div class="percentile-visualization">
                            <div class="percentile-progress-container">
                                <div class="percentile-progress-bg"></div>
                                <div class="percentile-progress-fill" id="percentile-progress"></div>
                                <div class="percentile-marker" id="percentile-marker"></div>
                            </div>
                            <div class="percentile-scale">
                                <div class="scale-marker">0</div>
                                <div class="scale-marker">25</div>
                                <div class="scale-marker">50</div>
                                <div class="scale-marker">75</div>
                                <div class="scale-marker">100</div>
                            </div>
                            <div class="percentile-labels">
                                <div class="percentile-label-section low">ต่ำ</div>
                                <div class="percentile-label-section medium">ปานกลาง</div>
                                <div class="percentile-label-section high">สูง</div>
                            </div>
                        </div>
                    </div>
                    <div class="percentile-details">
                        <div class="percentile-detail-item">
                            <i class="fas fa-users"></i>
                            <span>จำนวนนักเรียนที่เข้าสอบ: <span id="total-students">0</span> คน</span>
                        </div>
                        <div class="percentile-detail-item">
                            <i class="fas fa-chart-line"></i>
                            <span>คะแนนเฉลี่ยในการสอบนี้: <span id="average-score">0%</span></span>
                        </div>
                    </div>
                </div>
            </div>

                <!-- Statistical Measures Section -->
                <div class="statistics-section">
                    <h3>สถิติคะแนนของการสอบ</h3>
                    <div class="statistics-container">
                        <div class="statistic-item">
                            <div class="statistic-icon"><i class="fas fa-calculator"></i></div>
                            <div class="statistic-content">
                                <div class="statistic-label">Mean (ค่าเฉลี่ย)</div>
                                <div class="statistic-value">46.300</div>
                            </div>
                        </div>
                        <div class="statistic-item">
                            <div class="statistic-icon"><i class="fas fa-sort-numeric-up"></i></div>
                            <div class="statistic-content">
                                <div class="statistic-label">Median (มัธยฐาน)</div>
                                <div class="statistic-value">42.500</div>
                            </div>
                        </div>
                        <div class="statistic-item">
                            <div class="statistic-icon"><i class="fas fa-chart-bar"></i></div>
                            <div class="statistic-content">
                                <div class="statistic-label">Mode (ฐานนิยม)</div>
                                <div class="statistic-value">30.000</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="results-skills-section">
                    <h3>คะแนนตามทักษะ</h3>
                    <div class="skill-scores-container">
                        <div class="skill-score-item">
                            <div class="skill-icon speaking-icon">
                                <i class="fas fa-comment"></i>
                            </div>
                            <div class="skill-score-circle speaking">
                                <svg viewBox="0 0 36 36" class="score-chart">
                                    <path class="score-circle-bg"
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                    <path class="score-circle-fill"
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                                        id="speaking-score-path"/>
                                    <text x="18" y="19" class="score-text" id="speaking-score">0%</text>
                                </svg>
                            </div>
                            <div class="skill-label">การพูด/Speaking</div>
                            <div class="skill-info">
                                <span id="speaking-correct">0</span>/<span id="speaking-total">0</span>
                            </div>
                        </div>
                        
                        <div class="skill-score-item">
                            <div class="skill-icon reading-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="skill-score-circle reading">
                                <svg viewBox="0 0 36 36" class="score-chart">
                                    <path class="score-circle-bg"
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                    <path class="score-circle-fill"
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                                        id="reading-score-path"/>
                                    <text x="18" y="19" class="score-text" id="reading-score">0%</text>
                                </svg>
                            </div>
                            <div class="skill-label">การอ่าน/Reading</div>
                            <div class="skill-info">
                                <span id="reading-correct">0</span>/<span id="reading-total">0</span>
                            </div>
                        </div>
                        
                        <div class="skill-score-item">
                            <div class="skill-icon writing-icon">
                                <i class="fas fa-pen"></i>
                            </div>
                            <div class="skill-score-circle writing">
                                <svg viewBox="0 0 36 36" class="score-chart">
                                    <path class="score-circle-bg"
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                    <path class="score-circle-fill"
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                                        id="writing-score-path"/>
                                    <text x="18" y="19" class="score-text" id="writing-score">0%</text>
                                </svg>
                            </div>
                            <div class="skill-label">การเขียน/Writing</div>
                            <div class="skill-info">
                                <span id="writing-correct">0</span>/<span id="writing-total">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                

                <div class="results-details-section-bottom">
                    <div class="type-scores-section">
                        <h3>คะแนนตามประเภทข้อสอบ</h3>
                        <div class="type-breakdown-grid">
                            <div class="type-breakdown-item">
                                <div class="type-icon short-conversation-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Short Conversation</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="short-conversation-progress"></div>
                                    </div>
                                    <span class="type-score" id="short-conversation-score">0/12</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon long-conversation-icon">
                                    <i class="fas fa-comment-dots"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Long Conversation</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="long-conversation-progress"></div>
                                    </div>
                                    <span class="type-score" id="long-conversation-score">0/8</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon advertisement-icon">
                                    <i class="fas fa-ad"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Advertisement</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="advertisement-progress"></div>
                                    </div>
                                    <span class="type-score" id="advertisement-score">0/6</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon product-icon">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Product</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="product-progress"></div>
                                    </div>
                                    <span class="type-score" id="product-score">0/12</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon news-report-icon">
                                    <i class="fas fa-newspaper"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">News Report</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="news-report-progress"></div>
                                    </div>
                                    <span class="type-score" id="news-report-score">0/8</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon article-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Article</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="article-progress"></div>
                                    </div>
                                    <span class="type-score" id="article-score">0/16</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon text-completion-icon">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Text Completion</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="text-completion-progress"></div>
                                    </div>
                                    <span class="type-score" id="text-completion-score">0/15</span>
                                </div>
                            </div>
                            <div class="type-breakdown-item">
                                <div class="type-icon paragraph-icon">
                                    <i class="fas fa-paragraph"></i>
                                </div>
                                <div class="type-content">
                                    <span class="type-name">Paragraph</span>
                                    <div class="type-progress">
                                        <div class="type-progress-bar" id="paragraph-progress"></div>
                                    </div>
                                    <span class="type-score" id="paragraph-score">0/5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="score-suggestions" class="suggestions-container">
                        <h3>คำแนะนำ</h3>
                        <div class="suggestions-content">
                            <!-- Suggestions will be inserted here by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div id="score-histogram" class="histogram-container">
                    <!-- Score histogram will be inserted here by JavaScript -->
                </div>
                
                <div id="feedback" class="feedback-container hidden">
                    <div class="feedback-header">
                        <h3>รายละเอียดคำตอบแต่ละข้อ</h3>
                        <button class="btn-close-feedback" id="close-feedback">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="feedback-list">
                        <!-- Feedback items will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer will be included here -->
    <div id="footer-placeholder"></div>

    <script src="../assets/js/responsive.js"></script>
    <script src="../assets/js/include.js"></script>
    <script src="../assets/js/progress.js"></script>
    <script src="../assets/js/combined_exam.js"></script>
    <script src="../assets/js/ad-banner.js"></script>
    <script>
        // Handle new results page UI interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle feedback section visibility
            const viewFeedbackBtn = document.getElementById('view-feedback');
            const closeFeedbackBtn = document.getElementById('close-feedback');
            const feedbackSection = document.getElementById('feedback');
            
            if (viewFeedbackBtn && feedbackSection) {
                viewFeedbackBtn.addEventListener('click', function() {
                    feedbackSection.classList.toggle('hidden');
                });
            }
            
            if (closeFeedbackBtn && feedbackSection) {
                closeFeedbackBtn.addEventListener('click', function() {
                    feedbackSection.classList.add('hidden');
                });
            }
            
            // Function to update progress bars for question types
            window.updateTypeProgressBars = function(typeScores) {
                // For each type, update the progress bar based on score
                const updateTypeProgress = (typeId, score) => {
                    const progressBar = document.getElementById(`${typeId}-progress`);
                    if (progressBar) {          
                        const [correct, total] = score.split('/');
                        const percentage = (parseInt(correct) / parseInt(total)) * 100;
                        progressBar.style.width = `${percentage}%`;
                        
                        // Update color based on score
                        if (percentage < 40) {
                            progressBar.style.backgroundColor = '#f44336'; // Red for poor scores
                        } else if (percentage < 70) {
                            progressBar.style.backgroundColor = '#ff9800'; // Orange for average scores
                        } else {
                            progressBar.style.backgroundColor = '#4caf50'; // Green for good scores
                        }
                    }
                };
                
                // Update each type's progress bar
                updateTypeProgress('short-conversation', document.getElementById('short-conversation-score').textContent);
                updateTypeProgress('long-conversation', document.getElementById('long-conversation-score').textContent);
                updateTypeProgress('advertisement', document.getElementById('advertisement-score').textContent);
                updateTypeProgress('product', document.getElementById('product-score').textContent);
                updateTypeProgress('news-report', document.getElementById('news-report-score').textContent);
                updateTypeProgress('article', document.getElementById('article-score').textContent);
                updateTypeProgress('text-completion', document.getElementById('text-completion-score').textContent);
                updateTypeProgress('paragraph', document.getElementById('paragraph-score').textContent);
            };
            
            // Function to update percentile visualization
            window.updatePercentileVisualization = function(percentile) {
                // Update percentile number and text
                const percentileValue = document.getElementById('percentile-value');
                const percentileText = document.getElementById('percentile-text');
                if (percentileValue && percentileText) {
                    percentileValue.textContent = percentile;
                    percentileText.textContent = `${percentile}%`;
                }
                
                // Update progress bar fill width
                const progressFill = document.getElementById('percentile-progress');
                if (progressFill) {
                    progressFill.style.width = `${percentile}%`;
                }
                
                // Update the marker position based on percentile
                const percentileMarker = document.getElementById('percentile-marker');
                if (percentileMarker) {
                    percentileMarker.style.transform = `translateX(${percentile}%)`;
                }
            };
            
            // Override the existing displayPercentileRank function to use our visualization
            const originalDisplayPercentileRank = window.displayPercentileRank;
            if (typeof originalDisplayPercentileRank === 'function') {
                window.displayPercentileRank = function(percentile, rank, totalStudents, originalScore, adjustedScore) {
                    // Call the original function first if it exists
                    if (originalDisplayPercentileRank) {
                        originalDisplayPercentileRank(percentile, rank, totalStudents, originalScore, adjustedScore);
                    }
                    
                    // Update our new visualization
                    window.updatePercentileVisualization(percentile);
                    
                    // Update total students and average score
                    const totalStudentsEl = document.getElementById('total-students');
                    const averageScoreEl = document.getElementById('average-score');
                    
                    if (totalStudentsEl) {
                        totalStudentsEl.textContent = totalStudents || '1000'; // Default value if not provided
                    }
                    
                    if (averageScoreEl) {
                        // Use adjusted score as average if available, otherwise use 65% as a default
                        const avgScore = adjustedScore || '65%';
                        averageScoreEl.textContent = avgScore;
                    }
                };
            }
            
            // Override the existing updateTypeScores function to also update progress bars
            const originalUpdateTypeScores = window.updateTypeScores;
            if (typeof originalUpdateTypeScores === 'function') {
                window.updateTypeScores = function(result) {
                    // Call the original function first
                    originalUpdateTypeScores(result);
                    
                    // Then update progress bars
                    window.updateTypeProgressBars();
                };
            }
            
            // If calculatePercentileRank exists, make sure it gets called when results are shown
            const originalCalculateResults = window.calculateResults;
            if (typeof originalCalculateResults === 'function') {
                window.calculateResults = function() {
                    // Call original function
                    const results = originalCalculateResults();
                    
                    // Make sure the percentile visualization is updated
                    if (typeof window.calculatePercentileRank === 'function') {
                        const userScore = parseFloat(document.getElementById('score').textContent);
                        if (!isNaN(userScore)) {
                            // Use mock data if real data isn't available
                            const mockScore = userScore.toFixed(0);
                            window.updatePercentileVisualization(mockScore);
                            
                            // Call calculatePercentileRank - it handles showing the percentile via displayPercentileRank
                            window.calculatePercentileRank(userScore);
                            
                            // Set default values for total students and average score
                            // These will be overwritten by displayPercentileRank if it completes successfully
                            document.getElementById('total-students').textContent = '1238';
                            document.getElementById('average-score').textContent = '68%';
                        }
                    }
                    
                    return results;
                };
            }
        });
    </script>
</body>
</html> 